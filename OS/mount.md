# 磁盘分区、格式化与挂载
[参照文章](https://help.aliyun.com/document_detail/25426.html?spm=5176.11065259.1996646101.searchclickresult.526e7988ecU1B0)

## 磁盘分区
- 查看是否有数据盘 `fdisk -l`
- 运行 `fdisk /dev/vdb` 对数据盘进行分区。
- 输入 n 并按回车键：创建一个新分区。
- 输入 p 并按回车键：选择主分区。因为创建的是一个单分区数据盘，所以只需要创建主分区。
- 说明：如果要创建 4 个以上的分区，您应该创建至少一个扩展分区，即选择 e。
- 输入分区编号并按回车键。因为这里仅创建一个分区，可以输入 1。
- 输入第一个可用的扇区编号：按回车键采用默认值 1。
- 输入最后一个扇区编号：因为这里仅创建一个分区，所以按回车键采用默认值。
- 输入 wq 并按回车键，开始分区。
- 查看新的分区 `fdisk -l`

## 磁盘格式化
- 查看系统支持的文件系统格式 `cat /etc/filesystems`
- 在新分区上创建文件系统 `mkfs.ext4 /dev/vdb1`
- 向 /etc/fstab 写入新分区信息：运行命令 `echo /dev/vdb1 /mnt ext4 defaults 0 0 >> /etc/fstab`，便于开机后自动挂载磁盘
- /etc/fstab文件配置说明
    + 第一列：挂载的磁盘
    + 第二列：挂载的位置
    + 第三列：挂载磁盘的分区类型
    + 第四列：挂载时的选项
    + 第五列：能否被dump备份命令作用：dump是一个用来作为备份的命令。通常这个参 数的值为0或者1
        * 0：代表不要做dump备份
        * 1：代表要每天进行dump的操作
        * 2：代表不定日期的进行dump操作
    + 第六列：是否检验扇区：开机的过程中，系统默认会以fsck检验我们系统是否为完整（clean）。
        * 0：不要检验
        * 1：最早检验（一般根目录会选择）
        * 2：1级别检验完成之后进行检验-

## 挂载
- 查看当前系统挂载的所有分区、分区文件系统的类型、挂载点及一些选项等信息 `mount`
- 挂载 `mount /dev/vdb1 /mnt`
- 查看目前磁盘空间和使用情况 `df -h`

## 卸载
- 卸载 `umount /dev/vdb1`

## 遇到的问题

### 新硬盘挂载目录后文件消失解决办法
- 问题描述
```
项目初期用户文件较少,全部存储在/home目录下,/home目录没有单独划开分区,随着项目网站做大,用户文件越来越多,/home目录不够空间,想挂载一个新硬盘来负责储存
但发现新挂载/home到新硬盘时,/home原来数据变空了,这个原因是由于linux的VFS（虚拟文件系统）机制导致的,正常登录以后，所看到的各个目录，文件都是内核在加载时候构造在内存中的VFS目录树，而不是直接看到硬盘上的实际目录树。当你挂载某个设备到一个VFS挂载点上时(比如/home），系统就把VFS中的这个挂载点/home指向你最后所挂载的那个设备上。那么你现在访问该挂载点时，就会看到你最后挂载在此处的设备。而之前所挂载的设备依然在那里，只不过挂载点/home已经不再指向之前的设备。所以之前的数据是被隐藏了,但并没有删除,若umount挂载后,数据又重新回来了
```
- 解决办法
```
基于这种情况,只能通过跳板的方式把原来的/home数据复制到新的/home分区下了 ,如何添加新硬盘,请查找相关资料
mkdir /new  ###跳板目录
mount /dev/sdb1 /new  ###首先挂载跳板目录
cp -R /home/*  /new  ###复制/home目录所有数据到/new先
rm -rf /home/*       ####可选,主要为了腾出空间给原来的硬盘

mount /dev/sdb1 /home ###挂载/home 到新硬盘,此时你会神奇的发现之前的/home目录文件已经全部转移过来了,也许你会有点疑问,我并没有复制或移动/new文件到新挂载的/home目录啊,其实此时的/home目录相当于/new目录的硬链接,可以测试下mkdir /new/test 你会发现/home目录也存在test

umount /new ###解除挂载,可能会出现占用无法删除,可以使用 umount -fl 强行卸载,
-f 强制卸载
-l 一空闲马上卸载所有占用的文件系统。
rm -rf /new ###删除跳板目录

echo  "/dev/sdb1  /home    ext3或ext4    defaults    0 0" >> /etc/fstab ###开机启动挂载目录
```